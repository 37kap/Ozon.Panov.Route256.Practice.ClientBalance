## Домашнее задание 4 недели обучения

### Описание
В рамках задания мы разрабатываем новый сервис, управляющий балансом пользователей нашей системы. Данный сервис должен по запросу инициализировать новых пользователей. Управлять их балансом с помощью пополнения или снятия, например, для оплаты новых заказов. А также затем отображать баланс в личном кабинете пользователей. В доп задании также удаляются операции, которые потеряли актуальность и больше не нужны. И также добавляется возможность для просмотра истории пользователями, либо поддержкой.

## Требуется

- Создать новый сервис ClientBalance
- Добавить ClientBalance в docker-compose
- Развернуть инфраструктуру для БД

#### Основное задание:

- У сервиса должны быть реализованы 5 gRPC ручек:
    1. Создание нового пользователя
        - Входные данные:
            - Идентификатор пользователя (long)
        - Выходные данные:
            - Отсутствуют 
    2. Операция пополнения баланса
        - Входные данные:
            - Идентификатор операции (guid)
            - Идентификатор пользователя
            - Сумма пополнения
            - Время
        - Выходные данные:
            - Отсутствуют 
        - Примечание:
            - Сумма должна зачисляться только после подтверждения
    3. Операция снятия денег с баланса
        - Входные данные:
            - Идентификатор операции (guid)
            - Идентификатор пользователя
            - Сумма снятия
            - Время
        - Выходные данные:
            - Данные о возможности проведения опреации. В случае если баланса недостаточно, то вернуть false 
        - Примечание:
            - Сумма должна вычитаться из баланса сразу же, если это возможно. Иначе необходимо сохранять в БД информацию об отмене. Например, в статусе reject
    4. Изменения статуса операции
        - Входные данные:
            - Идентификатор операции (guid)
            - Тип операции (TopUp, Withdraw)
            - Идентификатор пользователя
            - Статус операции (cancelled, completed)
            - Время
        - Выходные данные:
            - Отсутствуют 
        - Примечание:
            - В случае с пополением сумма либо добавляется (completed), либо нет (cancelled).
            - В случае со снятием необходимо либо вернуть средста на счет (cancelled), либо оставить (completed).
    5. Получение текущего баланса пользователя
        - Входные данные:
            - Id пользователя
        - Выходные данные:
            - Текущий баланс
- Статусы у опреций могут быть следующими:
    - pending
    - cancelled
    - completed
    - reject
- Обеспечить хранение пользователей и операций. Тип полей выбирать исходя из полей ваших моделей данных.
- Создать слой миграций, используя `FluentMigrator`. Миграция должна быть строго SQL, fluent-синтаксис недопустим. Миграция должна создавать БД и необходимые индексы. Необходимость индекса определяется самостоятельно.
- Реализовать репозитории. Все методы репозиториев должны быть асинхронными (возвращать `Task<>`) и поддерживать отмену (`CancellationToken`).
- Написать интеграционные тесты для репозиториев или целиком сервиса через gRPC API.

#### Настройки сервиса

Настройки можно указать через переменные окружения.

#### Строка подключения к серверу БД №1
Название переменной окружения: `ROUTE256_VIEW_ORDER_SERVICE_DB_CONNECTION_STRINGS`
Допустимые значения (строка)

#### Дополнительное задание:

- У сервиса дожно быть реализованы gRPC 2 ручки:
    1. Ручка по удалению устаревших операций
        - Входные данные:
            - Массив (Идентификатор операции + тип операции)
        - Выходные данные:
            - Отсутствуют 
    2. Ручка с историей по операциям
        - Входные данные:
            - Идентификатор пользователя
        - Выходные данные:
            - Идентификатор операции 
            - Тип операции
            - Сумма
            - Статус
            - Время
            - (Дополнительное для дополнительного: добавить limit Offset)
         - Примечание:
            - Необходимо создать таблицу с автоувеличивающимся ключом, чтобы по нему доставать оперции в правильном порядке. Операции должны возвращаться по порядку их первоначальному происхождению, а также только их финальный статус, если были переходы. При этом в таблице должна храниться вся история с операциями. Что по сути является логом всех операций.

### Дедлайны сдачи и проверки задания: 
- 15 марта 23:59 (сдача) / 18 марта, 23:59 (проверка)
